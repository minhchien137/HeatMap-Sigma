@{
    Layout = "_Layout";
    ViewData["Title"] = "Báo cáo & phân tích";
    ViewData["PageName"] = "Report";
}

<div class="min-h-screen bg-gradient-to-br from-gray-50 to-red-50/30 py-8 px-4">
    <div class="max-w-[1600px] mx-auto">

        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h1 class="text-4xl font-black mb-2">
                        <span class="bg-gradient-to-r from-gray-900 to-red-600 bg-clip-text text-transparent">
                            Báo cáo & Phân tích
                        </span>
                    </h1>
                    <p class="text-gray-500 font-medium">Project Resource Capacity & Utilization Report</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="exportReport()"
                            class="px-6 py-3 bg-white border-2 border-gray-200 rounded-xl font-bold text-gray-700 hover:border-red-600 hover:text-red-600 transition-all shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" fill="none"
                             viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        Xuất báo cáo
                    </button>
                    <button onclick="refreshData()"
                            class="px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 rounded-xl font-bold text-white hover:shadow-lg hover:shadow-red-600/30 transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-2" fill="none"
                             viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        Làm mới
                    </button>
                </div>
            </div>

            <!-- Filters Section -->
            <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-7 gap-4">
                    <!-- Time Range -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Khoảng thời gian</label>
                        <select id="timeRange"
                                class="w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:border-red-600 focus:outline-none font-medium text-sm">
                            <option value="current_week">Tuần hiện tại</option>
                            <option value="last_week">Tuần trước</option>
                            <option value="current_month">Tháng hiện tại</option>
                            <option value="last_month">Tháng trước</option>
                            <option value="current_quarter">Quý hiện tại</option>
                            <option value="current_year">Năm hiện tại</option>
                            <option value="custom">Tùy chỉnh</option>
                        </select>
                    </div>

                    <!-- Year -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Năm</label>
                        <select id="yearFilter"
                                class="w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:border-red-600 focus:outline-none font-medium text-sm">
                            <option value="">Tất cả</option>
                        </select>
                    </div>

                    <!-- Customer -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Customer</label>
                        <select id="customerFilter"
                                class="w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:border-red-600 focus:outline-none font-medium text-sm">
                            <option value="">Tất cả customer</option>
                        </select>
                    </div>

                    <!-- Department -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Bộ phận</label>
                        <select id="departmentFilter"
                                class="w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:border-red-600 focus:outline-none font-medium text-sm">
                            <option value="">Tất cả bộ phận</option>
                        </select>
                    </div>

                    <!-- Project -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Dự án</label>
                        <select id="projectFilter"
                                class="w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:border-red-600 focus:outline-none font-medium text-sm">
                            <option value="">Tất cả dự án</option>
                        </select>
                    </div>

                    <!-- Phase -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Phase</label>
                        <select id="phaseFilter"
                                class="w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:border-red-600 focus:outline-none font-medium text-sm">
                            <option value="">Tất cả phase</option>
                        </select>
                    </div>

                    <!-- Apply Button -->
                    <div class="flex items-end">
                        <button onclick="applyFilters()"
                                class="w-full px-4 py-2.5 bg-gradient-to-r from-red-600 to-red-700 rounded-xl font-bold text-white hover:shadow-lg hover:shadow-red-600/30 transition-all">
                            Áp dụng
                        </button>
                    </div>
                </div>

                <!-- Custom Date Range (Hidden by default) -->
                <div id="customDateRange" class="hidden mt-4 grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Từ ngày</label>
                        <input type="date" id="startDate"
                               class="w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:border-red-600 focus:outline-none font-medium">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Đến ngày</label>
                        <input type="date" id="endDate"
                               class="w-full px-4 py-2.5 border-2 border-gray-200 rounded-xl focus:border-red-600 focus:outline-none font-medium">
                    </div>
                </div>
            </div>
        </div>

        <!-- KPIs Dashboard -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
            <!-- Total Hours -->
            <div
                class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 hover:shadow-xl hover:-translate-y-1 transition-all">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-red-50 rounded-xl flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-600" fill="none"
                             viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">Actual Hours</span>
                </div>
                <div class="text-4xl font-black text-gray-900 mb-1" id="kpi_totalHours">0</div>
                <div class="text-sm font-medium text-gray-500">Tổng giờ đã làm</div>
            </div>

             <!-- Available Capacity -->
            <div
                class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 hover:shadow-xl hover:-translate-y-1 transition-all">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-teal-50 rounded-xl flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-teal-600" fill="none"
                             viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M9 12l2 2 4-4" />
                        </svg>
                    </div>
                    <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">Available Capacity</span>
                </div>
                <div class="text-4xl font-black text-gray-900 mb-1" id="kpi_availableCapacity">0</div>
                <div class="text-sm font-medium text-gray-500">Tổng giờ có thể làm</div>
            </div>

            <!-- Average Utilization -->
            <div
                class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 hover:shadow-xl hover:-translate-y-1 transition-all">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none"
                             viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                    </div>
                    <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">Hiệu suất</span>
                </div>
                <div class="text-4xl font-black text-gray-900 mb-1" id="kpi_avgUtilization">0%</div>
                <div class="text-sm font-medium text-gray-500">Tỷ lệ sử dụng nguồn lực</div>
            </div>

            <!-- Active Projects -->
            <div
                class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 hover:shadow-xl hover:-translate-y-1 transition-all">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" fill="none"
                             viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                        </svg>
                    </div>
                    <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">Dự án</span>
                </div>
                <div class="text-4xl font-black text-gray-900 mb-1" id="kpi_activeProjects">0</div>
                <div class="text-sm font-medium text-gray-500">Dự án đang hoạt động</div>
            </div>

            <!-- Staff Count -->
            <div
                class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 hover:shadow-xl hover:-translate-y-1 transition-all">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-600" fill="none"
                             viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                    </div>
                    <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">Nhân sự</span>
                </div>
                <div class="text-4xl font-black text-gray-900 mb-1" id="kpi_staffCount">0</div>
                <div class="text-sm font-medium text-gray-500">Tổng số nhân viên</div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Trend Chart -->
            <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-black text-gray-900">Biểu đồ xu hướng </h2>
                    <div class="flex gap-2">
                        <button onclick="toggleChartView('week')" data-view="week"
                                class="chart-view-btn active px-3 py-1.5 rounded-lg text-sm font-bold transition-all">
                            Tuần
                        </button>
                        <button onclick="toggleChartView('month')" data-view="month"
                                class="chart-view-btn px-3 py-1.5 rounded-lg text-sm font-bold transition-all">
                            Tháng
                        </button>
                    </div>
                </div>
                <div class="h-80">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>

            <!-- Department Chart -->
            <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-black text-gray-900">Phân bổ theo bộ phận</h2>
                </div>
                <div class="h-80">
                    <canvas id="departmentChart"></canvas>
                </div>
            </div>
        </div>

        <!-- By Function / Utilization Table -->
        <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 mb-8">
            <div class="flex items-center justify-between mb-5">
                <div>
                    <h2 class="text-xl font-black text-gray-900">Công suất theo bộ phận (By Function)</h2>
                    <p class="text-sm text-gray-500 mt-1">Phân tích công suất sử dụng theo bộ phận</p>
                </div>
                <span id="functionWeekLabel" class="text-sm font-semibold text-gray-500 bg-gray-50 border border-gray-200 px-3 py-1.5 rounded-lg"></span>
                <div class="flex gap-2">
                    <button id="btnFunctionTable" onclick="switchFunctionView('table')"
                        class="px-4 py-2 rounded-xl text-sm font-bold border-2 transition-all border-red-600 bg-red-600 text-white">
                        By Table
                    </button>
                    <button id="btnFunctionChart" onclick="switchFunctionView('chart')"
                        class="px-4 py-2 rounded-xl text-sm font-bold border-2 transition-all border-gray-200 bg-white text-gray-500 hover:border-red-600 hover:text-red-600">
                        By Chart
                    </button>
                </div>
            </div>
            <!-- Table view -->
            <div id="functionTableView" class="overflow-x-auto">
                <table class="phase-pivot w-full text-sm" id="functionTable">
                    <thead id="functionTableHead">
                        <tr><th colspan="10" class="phase-loading">Đang tải dữ liệu...</th></tr>
                    </thead>
                    <tbody id="functionTableBody"></tbody>
                    <tfoot id="functionTableFoot"></tfoot>
                </table>
            </div>
            <!-- Chart view -->
            <div id="functionChartView" class="hidden" style="position:relative; height:360px;">
                <canvas id="functionChart"></canvas>
            </div>
        </div>

        <!-- Phase Pivot Table -->
        <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 mb-8">
            <div class="flex items-center justify-between mb-5">    
                <div>
                    <h2 class="text-xl font-black text-gray-900">Phân bổ giờ theo Phase (By Phase)</h2>
                    <p class="text-sm text-gray-500 mt-1">Tổng giờ làm việc theo Phase × Bộ phận</p>
                </div>
                <span id="phaseWeekLabel" class="text-sm font-semibold text-gray-500 bg-gray-50 border border-gray-200 px-3 py-1.5 rounded-lg"></span>
                <div class="flex gap-2">
                    <button id="btnByPhase" onclick="switchPhaseView('hours')"
                        class="px-4 py-2 rounded-xl text-sm font-bold border-2 transition-all border-red-600 bg-red-600 text-white">
                        By Phase
                    </button>
                    <button id="btnByPhasePct" onclick="switchPhaseView('pct')"
                        class="px-4 py-2 rounded-xl text-sm font-bold border-2 transition-all border-gray-200 bg-white text-gray-500 hover:border-red-600 hover:text-red-600">
                        By Phase %
                    </button>
                    <button id="btnByPhaseChart" onclick="switchPhaseView('chart')"
                        class="px-4 py-2 rounded-xl text-sm font-bold border-2 transition-all border-gray-200 bg-white text-gray-500 hover:border-red-600 hover:text-red-600">
                        By Chart
                    </button>
                </div>
            </div>
            <!-- Table view -->
            <div id="phaseTableView" class="overflow-x-auto">
                <table class="phase-pivot w-full text-sm">
                    <thead id="phaseTableHead">
                        <tr><th colspan="10" class="phase-loading">Đang tải dữ liệu...</th></tr>
                    </thead>
                    <tbody id="phaseTableBody"></tbody>
                    <tfoot id="phaseTableFoot"></tfoot>
                </table>
            </div>
            <!-- Chart view -->
            <div id="phaseChartView" class="hidden" style="position:relative; height:380px;">
                <canvas id="phaseChart"></canvas>
            </div>
        </div>

        <!-- By Customer Pivot Table -->
        <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 mb-8">
            <div class="flex items-center justify-between mb-5">
                <div>
                    <h2 class="text-xl font-black text-gray-900">Tổng giờ theo khách hàng (Total - By Customer)</h2>
                    <p class="text-sm text-gray-500 mt-1">Tổng số giờ theo Customer × Bộ phận</p>
                </div>
                <span id="customerWeekLabel" class="text-sm font-semibold text-gray-500 bg-gray-50 border border-gray-200 px-3 py-1.5 rounded-lg"></span>
                <div class="flex gap-2">
                    <button id="btnCustomerTable" onclick="switchCustomerView('table')"
                        class="px-4 py-2 rounded-xl text-sm font-bold border-2 transition-all border-red-600 bg-red-600 text-white">
                        By Table
                    </button>
                    <button id="btnCustomerChart" onclick="switchCustomerView('chart')"
                        class="px-4 py-2 rounded-xl text-sm font-bold border-2 transition-all border-gray-200 bg-white text-gray-500 hover:border-red-600 hover:text-red-600">
                        By Chart
                    </button>
                </div>
            </div>
            <!-- Table view -->
            <div id="customerTableView" class="overflow-x-auto">
                <table class="phase-pivot w-full text-sm">
                    <thead id="customerTableHead">
                        <tr><th colspan="10" class="phase-loading">Đang tải dữ liệu...</th></tr>
                    </thead>
                    <tbody id="customerTableBody"></tbody>
                    <tfoot id="customerTableFoot"></tfoot>
                </table>
            </div>
            <!-- Chart view -->
            <div id="customerChartView" class="hidden" style="position:relative; height:400px;">
                <canvas id="customerChart"></canvas>
            </div>
        </div>

        <!-- Detailed Table -->
        <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 mb-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-black text-gray-900">Chi tiết theo Dự án</h2>
                <button onclick="toggleTableSort()"
                        class="px-4 py-2 text-sm font-bold text-gray-700 hover:text-red-600 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12" />
                    </svg>
                    Sắp xếp
                </button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full" id="detailTable">
                    <thead class="bg-gray-50 border-b-2 border-gray-200">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-black text-gray-700 uppercase tracking-wider">Dự án</th>
                            <th class="px-6 py-4 text-left text-xs font-black text-gray-700 uppercase tracking-wider">Bộ phận</th>
                            <th class="px-6 py-4 text-center text-xs font-black text-gray-700 uppercase tracking-wider">Số người</th>
                            <th class="px-6 py-4 text-center text-xs font-black text-gray-700 uppercase tracking-wider">Tổng giờ</th>
                            <th class="px-6 py-4 text-center text-xs font-black text-gray-700 uppercase tracking-wider">TB giờ/người</th>
                            <th class="px-6 py-4 text-center text-xs font-black text-gray-700 uppercase tracking-wider">Trạng thái</th>
                            <th class="px-6 py-4 text-center text-xs font-black text-gray-700 uppercase tracking-wider">Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="detailTableBody" class="divide-y divide-gray-100">
                        <tr>
                            <td colspan="7" class="px-6 py-12 text-center text-gray-400">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-3 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                <p class="font-medium">Không có dữ liệu</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<!-- Detail Modal -->
<div id="detailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl">
        <div class="p-6 border-b border-gray-200">
            <div class="flex items-center justify-between">
                <h3 class="text-2xl font-black text-gray-900" id="modalTitle">Chi tiết</h3>
                <button onclick="closeDetailModal()" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>
        <div class="p-6 overflow-y-auto max-h-[calc(90vh-140px)]" id="modalContent"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
<script src="~/js/report.js"></script>

<style>
    .chart-view-btn { background-color: #f3f4f6; color: #6b7280; }
    .chart-view-btn.active { background: linear-gradient(to right,#dc2626,#b91c1c); color:#fff; box-shadow:0 4px 6px -1px rgba(220,38,38,.2); }
    .heatmap-cell { transition:all .2s; cursor:pointer; }
    .heatmap-cell:hover { transform:scale(1.05); box-shadow:0 4px 12px rgba(0,0,0,.15); z-index:10; }
    .status-low    { background:#dcfce7; color:#166534; border:1px solid #86efac; }
    .status-medium { background:#fef3c7; color:#92400e; border:1px solid #fcd34d; }
    .status-high   { background:#fee2e2; color:#991b1b; border:1px solid #fca5a5; }
    .status-overload { background:#fecaca; color:#7f1d1d; border:1px solid #f87171; }

    /* ===== PHASE PIVOT TABLE ===== */
    .phase-pivot { border-collapse: collapse; width: 100%; }
    .phase-pivot th,
    .phase-pivot td { border: 0; border-bottom: 1px solid #f3f4f6; padding: 12px 16px; white-space: nowrap; }

    /* Loading placeholder */
    .phase-loading {
        padding: 2rem; text-align: center;
        background: #fff; color: #9ca3af;
        font-weight: 500; font-size: 0.875rem;
        text-transform: none; letter-spacing: 0; border: none;
    }

    /* ─── HEADER ─── */
    .phase-pivot thead th {
        background: #f9fafb; color: #6b7280;
        font-weight: 700; font-size: 0.7rem;
        text-transform: uppercase; letter-spacing: 0.08em;
        text-align: center;
        border-bottom: 2px solid #f3f4f6;
    }
    .phase-pivot thead th.th-phase  { text-align: left; min-width: 90px; }
    .phase-pivot thead th.th-dept   { min-width: 85px; }
    .phase-pivot thead th.th-total  { min-width: 80px; }
    .phase-pivot thead th.th-pct    { color: #dc2626; min-width: 65px; }

    /* ─── BODY ─── */
    .phase-pivot tbody td           { background: #fff; color: #374151; text-align: center; font-weight: 500; font-size: 0.875rem; }
    .phase-pivot tbody td.td-phase  { background: #fff; color: #111827; text-align: left;  font-weight: 700; }
    .phase-pivot tbody td.td-total  { background: #fff; color: #111827; font-weight: 700; }
    .phase-pivot tbody td.td-pct    { background: #fff; color: #dc2626; font-weight: 700; }

    /* ─── FOOTER ─── */
    .phase-pivot tfoot td           { background: #f9fafb; color: #6b7280; text-align: center; font-weight: 700; font-size: 0.875rem; border-top: 2px solid #f3f4f6; border-bottom: 0; }
    .phase-pivot tfoot td.td-phase  { text-align: left; }
    .phase-pivot tfoot td.td-total  { color: #111827; }
    .phase-pivot tfoot td.td-pct    { color: #dc2626; }

    /* ─── HOVER ─── */
    .phase-pivot tbody tr:hover td          { background: #fef2f2 !important; }
    .phase-pivot tbody tr:hover td.td-pct   { color: #b91c1c !important; }

    /* ─── CUSTOMER TABLE – customer group rows ─── */
    .td-customer-name { 
        background: #f9fafb !important; 
        color: #111827; 
        text-align: left; 
        font-weight: 800;
        font-size: 0.875rem;
    }
    .td-project-name {
        text-align: left !important;
        padding-left: 2rem !important;
        color: #374151;
        font-weight: 500;
    }
    .tr-customer-total td {
        background: #fef2f2 !important;
        font-weight: 700;
        color: #991b1b;
        border-top: 2px solid #fca5a5 !important;
    }
    .tr-customer-total td.td-phase { color: #991b1b !important; font-weight: 800; }
</style>